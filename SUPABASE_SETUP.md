# 🎊 Supabase Setup Guide - Mil Dias de Amor\n\n## Complete Brazilian Wedding Website Backend Setup\n\nThis guide will help you set up the complete Supabase backend for Hel & Ylana's wedding website with all Brazilian-specific configurations.\n\n## 📋 Prerequisites\n\n1. **Supabase Account**: Create account at [supabase.com](https://supabase.com)\n2. **SendGrid Account**: Create account at [sendgrid.com](https://sendgrid.com)\n3. **Mercado Pago Account**: Create account at [mercadopago.com.br](https://mercadopago.com.br)\n\n## 🗄️ Step 1: Create Supabase Project\n\n1. Go to [Supabase Dashboard](https://app.supabase.com)\n2. Click \"New Project\"\n3. Choose organization and set:\n   - **Name**: `thousanddaysoflove` or `mil-dias-de-amor`\n   - **Database Password**: Strong password (save this!)\n   - **Region**: `South America (São Paulo)` for Brazilian users\n4. Wait for project creation (2-3 minutes)\n\n## 🏗️ Step 2: Run Database Migrations\n\n### Option A: Using Supabase SQL Editor (Recommended)\n\n1. Go to your project dashboard\n2. Navigate to **SQL Editor** in the sidebar\n3. Create a new query and run each migration file in order:\n\n#### Migration 1: Core Schema\n```sql\n-- Copy and paste contents of supabase/migrations/001_initial_schema.sql\n-- This creates: guests, gifts, payments, wedding_config tables\n```\n\n#### Migration 2: Security Policies\n```sql\n-- Copy and paste contents of supabase/migrations/002_rls_policies.sql\n-- This creates: RLS policies, admin functions, Brazilian validations\n```\n\n#### Migration 3: Sample Data\n```sql\n-- Copy and paste contents of supabase/migrations/003_sample_data.sql\n-- This creates: Sample gifts, guests, payments for testing\n```\n\n### Option B: Using Supabase CLI\n\n```bash\n# Install Supabase CLI\nnpm install -g supabase\n\n# Login to Supabase\nsupabase login\n\n# Link your project\nsupabase link --project-ref YOUR_PROJECT_REF\n\n# Push migrations\nsupabase db push\n```\n\n## 🔑 Step 3: Get API Keys\n\n1. Go to **Settings > API** in your Supabase dashboard\n2. Copy these values:\n   - **Project URL**: `https://xxxxx.supabase.co`\n   - **Anon/Public Key**: `eyJhbG...` (for client-side)\n   - **Service Role Key**: `eyJhbG...` (for server-side, keep secret!)\n\n## 📧 Step 4: Setup SendGrid\n\n1. Go to [SendGrid Dashboard](https://app.sendgrid.com)\n2. Navigate to **Settings > API Keys**\n3. Create new API key with **Full Access**\n4. Copy the API key (starts with `SG.`)\n5. Set up verified sender:\n   - Go to **Settings > Sender Authentication**\n   - Verify domain or single sender email\n   - Use: `noreply@thousanddaysoflove.com` or your domain\n\n### Optional: Create Email Templates\n\n1. Go to **Email API > Dynamic Templates**\n2. Create templates for:\n   - RSVP Confirmation\n   - RSVP Reminder\n   - Payment Confirmation\n3. Note template IDs for environment variables\n\n## 💳 Step 5: Setup Mercado Pago\n\n1. Go to [Mercado Pago Developers](https://www.mercadopago.com.br/developers)\n2. Create new application:\n   - **Name**: \"Mil Dias de Amor - Wedding Gifts\"\n   - **Description**: \"Payment processing for wedding gift registry\"\n3. Get credentials:\n   - **Access Token**: For server-side payments\n   - **Public Key**: For client-side integration\n4. Configure webhook URL:\n   - **URL**: `https://yoursite.com/api/webhooks/mercado-pago`\n   - **Events**: `payment`\n\n## 🌐 Step 6: Configure Environment Variables\n\n1. Copy `.env.local.example` to `.env.local`\n2. Fill in all values:\n\n```bash\n# Supabase Configuration\nNEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co\nNEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbG...\nSUPABASE_SERVICE_ROLE_KEY=eyJhbG...\n\n# SendGrid Configuration\nSENDGRID_API_KEY=SG.xxxxx\nSENDGRID_FROM_EMAIL=noreply@thousanddaysoflove.com\nSENDGRID_FROM_NAME=Hel & Ylana - Mil Dias de Amor\n\n# Mercado Pago Configuration\nMERCADO_PAGO_ACCESS_TOKEN=APP_USR-xxxxx\nMERCADO_PAGO_PUBLIC_KEY=APP_USR-xxxxx\nMERCADO_PAGO_WEBHOOK_SECRET=your_webhook_secret\n\n# Wedding Configuration\nWEDDING_DATE=2025-11-11\nRSVP_DEADLINE=2025-11-01\nADMIN_EMAIL=hel@thousanddaysoflove.com\n\n# Website Configuration\nNEXT_PUBLIC_SITE_URL=https://thousanddaysoflove.com\nNEXT_PUBLIC_SITE_NAME=Mil Dias de Amor - Hel & Ylana\n```\n\n## ✅ Step 7: Test the Setup\n\n### Test Database Connection\n\n```bash\nnpm run dev\n# Visit http://localhost:3000\n# Check browser console for any Supabase errors\n```\n\n### Test RSVP System\n\n1. Go to `/rsvp`\n2. Use test invitation code: `TEST001A`\n3. Submit RSVP form\n4. Check Supabase dashboard for new guest record\n\n### Test Admin Dashboard\n\n1. Go to `/admin`\n2. Check guest statistics\n3. Verify gift registry display\n4. Test CSV export functionality\n\n### Test Email Configuration\n\n```bash\n# Add this to a test API route or run in console\nimport { EmailService } from '@/lib/services/email'\n\nconst testResult = await EmailService.testEmailConfiguration()\nconsole.log('Email test result:', testResult)\n```\n\n## 🔧 Step 8: Production Deployment Setup\n\n### Vercel Deployment\n\n1. Connect your repository to Vercel\n2. Add all environment variables in Vercel dashboard\n3. Deploy and test production URLs\n\n### Domain Configuration\n\n1. Set up custom domain in Vercel\n2. Update `NEXT_PUBLIC_SITE_URL` with production URL\n3. Update Mercado Pago webhook URL with production domain\n\n### Security Checklist\n\n- ✅ RLS policies enabled on all tables\n- ✅ Service role key kept secret (server-side only)\n- ✅ Admin authentication configured\n- ✅ Webhook URLs use HTTPS\n- ✅ Brazilian phone/email validation active\n- ✅ Environment variables secured\n\n## 📊 Database Schema Overview\n\n### Tables Created\n\n1. **guests** - Wedding guest information and RSVPs\n2. **gifts** - Wedding gift registry with Brazilian prices (BRL)\n3. **payments** - Payment tracking with Mercado Pago integration\n4. **wedding_config** - Wedding details and configuration\n\n### Key Features\n\n- ✅ Brazilian phone number validation\n- ✅ BRL currency formatting\n- ✅ Portuguese language support\n- ✅ PIX payment method support\n- ✅ Real-time subscriptions\n- ✅ Admin dashboard functions\n- ✅ CSV export capabilities\n- ✅ Email automation triggers\n\n## 🎯 Sample Data Included\n\n- **21 Wedding Gifts** across 5 categories (Cozinha, Casa, Eletrônicos, Experiências, Decoração)\n- **10 Sample Guests** with Brazilian names and phone numbers\n- **5 Sample Payments** including PIX and credit card\n- **3 Test Invitation Codes**: TEST001A, TEST002B, TEST003C\n\n## 🆘 Troubleshooting\n\n### Common Issues\n\n1. **Connection Error**: Check Supabase URL and keys\n2. **RLS Policy Error**: Verify admin authentication\n3. **Email Not Sending**: Check SendGrid API key and sender verification\n4. **Payment Webhook Fails**: Verify Mercado Pago webhook URL and secret\n\n### Debug Commands\n\n```bash\n# Check database connection\nnpm run type-check\n\n# Test API endpoints\ncurl http://localhost:3000/api/webhooks/mercado-pago\n\n# View Supabase logs\n# Go to Supabase Dashboard > Logs\n```\n\n## 📞 Support\n\nIf you encounter issues:\n\n1. Check Supabase Dashboard logs\n2. Review browser console errors\n3. Verify all environment variables\n4. Test each service independently\n\n---\n\n**🎊 Congratulations! Your Brazilian wedding website backend is now ready for Hel & Ylana's special day! 💕**\n\nThe system supports:\n- ✅ Complete RSVP management in Portuguese\n- ✅ Brazilian gift registry with PIX payments\n- ✅ Email automation for wedding planning\n- ✅ Admin dashboard for guest tracking\n- ✅ Real-time updates and notifications\n- ✅ Mobile-optimized for Brazilian guests